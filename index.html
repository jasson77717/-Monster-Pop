<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ³¨åŠ›éŠæˆ²ï¼šé»é»å°æ€ªç¸</title>
    <!-- å¼•å…¥ Tailwind CSS ä»¥æ–¹ä¾¿è¨­è¨ˆç¾è§€çš„ä»‹é¢ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Tone.js ä¾†ç”¢ç”ŸéŠæˆ²éŸ³æ•ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* è‡ªè¨‚å­—é«”èˆ‡åŸºæœ¬æ¨£å¼ */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            touch-action: manipulation; /* é˜²æ­¢é›™æ“Šç¸®æ”¾ï¼Œæå‡è¡Œå‹•è£ç½®é«”é©— */
        }
        
        /* å°æ€ªç¸ç™¼å…‰çš„è„ˆè¡å‹•ç•« */
        @keyframes pulse-glow {
            0% {
                transform: scale(1.05);
                box-shadow: 0 0 10px 5px rgba(251, 191, 36, 0.5);
            }
            50% {
                transform: scale(1.2);
                box-shadow: 0 0 30px 20px rgba(251, 191, 36, 0.8);
            }
            100% {
                transform: scale(1.05);
                box-shadow: 0 0 10px 5px rgba(251, 191, 36, 0.5);
            }
        }

        /* å°æ€ªç¸æ ¼å­è¢«é¸ä¸­æ™‚ï¼Œå¥—ç”¨æ–°çš„è„ˆè¡å‹•ç•« */
        .monster-cell.active {
            background-color: #FBBF24 !important; /* å¼·åˆ¶ä½¿ç”¨äº®é»ƒè‰² */
            position: relative; /* ç¢ºä¿å‹•ç•«æ•ˆæœä¸æœƒè¢«å…¶ä»–å…ƒç´ é®æ“‹ */
            z-index: 10;
            animation: pulse-glow 1.2s infinite ease-in-out; /* æ‡‰ç”¨å‹•ç•«ï¼Œç„¡é™å¾ªç’° */
        }

        /* æŒ‰éˆ•çš„é»æ“Šå‹•ç•«æ•ˆæœ */
        .btn-press-animation {
            transition: transform 0.1s ease;
        }
        .btn-press-animation:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-blue-100 flex items-center justify-center min-h-screen">

    <div id="game-container" class="w-full max-w-md mx-auto p-4 md:p-6 bg-white rounded-2xl shadow-lg text-center">
        
        <h1 class="text-3xl md:text-4xl font-bold text-blue-800 mb-2">é»é»å°æ€ªç¸</h1>
        <p class="text-gray-600 mb-4">å°æ€ªç¸ç™¼å…‰æ™‚ï¼Œè¶•å¿«é»ç‰ ï¼</p>

        <!-- åˆ†æ•¸å’Œæ™‚é–“é¡¯ç¤º -->
        <div class="flex justify-around mb-6 text-xl md:text-2xl">
            <div>
                <span class="font-semibold text-gray-700">åˆ†æ•¸ï¼š</span>
                <span id="score" class="font-bold text-green-600">0</span>
            </div>
            <div>
                <span class="font-semibold text-gray-700">æ™‚é–“ï¼š</span>
                <span id="time" class="font-bold text-red-600">30</span>
            </div>
        </div>

        <!-- éŠæˆ²ä¸»ç•«é¢ (3x3 æ ¼å­) -->
        <div id="game-grid" class="grid grid-cols-3 gap-3 md:gap-4 aspect-square select-none">
            <!-- å°æ€ªç¸æ ¼å­æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <!-- éŠæˆ²æ§åˆ¶æŒ‰éˆ•å’Œè¨Šæ¯å€ -->
        <div id="controls" class="mt-6 h-16 flex items-center justify-center">
             <button id="start-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl text-2xl shadow-md btn-press-animation">
                é–‹å§‹éŠæˆ²
            </button>
            <div id="message-box" class="hidden text-2xl font-bold text-yellow-500"></div>
        </div>

    </div>

    <script>
        // --- éŠæˆ²å…ƒç´  ---
        const startBtn = document.getElementById('start-btn');
        const gameGrid = document.getElementById('game-grid');
        const scoreDisplay = document.getElementById('score');
        const timeDisplay = document.getElementById('time');
        const messageBox = document.getElementById('message-box');
        const controls = document.getElementById('controls');

        // --- éŠæˆ²è¨­å®š ---
        const GAME_TIME = 30; // éŠæˆ²ç¸½æ™‚é•· (ç§’)
        const MONSTER_COLORS = ['bg-red-300', 'bg-blue-300', 'bg-green-300', 'bg-yellow-300', 'bg-purple-300', 'bg-pink-300'];
        const GRID_SIZE = 9;

        // --- éŠæˆ²ç‹€æ…‹è®Šæ•¸ ---
        let score = 0;
        let timeLeft = GAME_TIME;
        let gameInterval = null; // æ§åˆ¶éŠæˆ²æ™‚é–“å€’æ•¸
        let monsterTimeout = null; // æ§åˆ¶å°æ€ªç¸å‡ºç¾
        let activeCellIndex = -1;
        let isGameActive = false;

        // --- éŸ³æ•ˆåˆæˆå™¨ (ä½¿ç”¨ Tone.js) ---
        // ã€éŒ¯èª¤ä¿®æ­£ã€‘: å°‡éŸ³æ•ˆå‡½å¼æ”¹ç‚ºæ¯æ¬¡å‘¼å«æ™‚éƒ½å‰µå»ºä¸€å€‹æ–°çš„åˆæˆå™¨å¯¦ä¾‹ã€‚
        // é€™æ¨£å¯ä»¥é¿å…å› å¿«é€Ÿé€£çºŒè§¸ç™¼è€Œå°è‡´çš„ Tone.js æ™‚é–“æ’ç¨‹è¡çªã€‚

        const playPopSound = () => {
            // ç‚ºæ¯æ¬¡æ’­æ”¾å‰µå»ºä¸€å€‹ç¨ç«‹çš„åˆæˆå™¨
            const synth = new Tone.Synth({
                oscillator: { type: 'triangle' },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.1 }
            }).toDestination();
            // æ’­æ”¾å®Œå¾Œç«‹å³é‡‹æ”¾è³‡æº
            synth.triggerAttackRelease('C4', '8n');
        };

        const successSound = () => {
            const synth = new Tone.PolySynth(Tone.Synth).toDestination();
            // æ’­æ”¾ä¸€å€‹é–‹å¿ƒçš„å’Œå¼¦
            synth.triggerAttackRelease(['C4', 'E4', 'G4'], '8n');
        };

        const missSound = () => {
             const synth = new Tone.Synth({
                oscillator: { type: 'sawtooth' }, // ä½¿ç”¨ä¸åŒçš„éŸ³è‰²ä»¥å€åˆ†
                envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.2 }
            }).toDestination();
            // æ’­æ”¾ä¸€å€‹ä½æ²‰çš„éŸ³æ•ˆ
            synth.triggerAttackRelease('A2', '8n');
        };

        const endSound = () => {
            const synth = new Tone.PolySynth(Tone.Synth).toDestination();
            synth.triggerAttackRelease(['G4', 'E4', 'C4'], '8n');
        }

        // --- éŠæˆ²åŠŸèƒ½ ---

        // 1. åˆå§‹åŒ–éŠæˆ²æ ¼å­
        function createGrid() {
            gameGrid.innerHTML = ''; // æ¸…ç©ºèˆŠçš„æ ¼å­
            for (let i = 0; i < GRID_SIZE; i++) {
                const cell = document.createElement('div');
                cell.classList.add('monster-cell', 'w-full', 'h-full', 'rounded-full', 'cursor-pointer', 'transition-all', 'duration-200', 'flex', 'items-center', 'justify-center');
                const randomColor = MONSTER_COLORS[Math.floor(Math.random() * MONSTER_COLORS.length)];
                cell.classList.add(randomColor);
                cell.dataset.index = i;
                cell.innerHTML = `<div class="text-4xl md:text-5xl transform rotate-${Math.random() > 0.5 ? '12' : '-12'}">ğŸ¤ª</div>`;
                cell.addEventListener('click', handleCellClick);
                gameGrid.appendChild(cell);
            }
        }

        // 2. é–‹å§‹éŠæˆ²
        function startGame() {
            // åˆå§‹åŒ–éŸ³æ•ˆ (æŸäº›ç€è¦½å™¨éœ€è¦ä½¿ç”¨è€…äº’å‹•å¾Œæ‰èƒ½æ’­æ”¾)
            Tone.start(); 

            isGameActive = true;
            score = 0;
            timeLeft = GAME_TIME;
            scoreDisplay.textContent = score;
            timeDisplay.textContent = timeLeft;

            startBtn.classList.add('hidden');
            messageBox.classList.add('hidden');
            
            createGrid(); 

            gameInterval = setInterval(updateTimer, 1000);
            showMonster();
        }

        // 3. çµæŸéŠæˆ²
        function endGame() {
            isGameActive = false;
            clearInterval(gameInterval);
            clearTimeout(monsterTimeout);
            
            endSound();
            
            messageBox.textContent = `éŠæˆ²çµæŸï¼å¾—åˆ° ${score} åˆ†`;
            messageBox.classList.remove('hidden');
            startBtn.textContent = 'å†ç©ä¸€æ¬¡';
            startBtn.classList.remove('hidden');

            const activeCell = document.querySelector('.monster-cell.active');
            if (activeCell) {
                activeCell.classList.remove('active');
            }
        }

        // 4. æ›´æ–°è¨ˆæ™‚å™¨
        function updateTimer() {
            timeLeft--;
            timeDisplay.textContent = timeLeft;
            if (timeLeft <= 0) {
                endGame();
            }
        }

        // 5. éš¨æ©Ÿé¡¯ç¤ºä¸€éš»ç™¼å…‰çš„å°æ€ªç¸
        function showMonster() {
            if (!isGameActive) return;

            const oldCell = document.querySelector('.monster-cell.active');
            if (oldCell) {
                oldCell.classList.remove('active');
            }

            activeCellIndex = Math.floor(Math.random() * GRID_SIZE);
            const cell = gameGrid.children[activeCellIndex];
            cell.classList.add('active');

            // ã€éŒ¯èª¤ä¿®æ­£ã€‘å‘¼å«æ–°çš„éŸ³æ•ˆå‡½å¼
            playPopSound();

            const timeToShow = Math.max(400, 1800 - score * 40);
            monsterTimeout = setTimeout(() => {
                if (isGameActive) {
                    missSound();
                    showMonster();
                }
            }, timeToShow);
        }

        // 6. è™•ç†é»æ“Šäº‹ä»¶
        function handleCellClick(event) {
            if (!isGameActive) return;

            const clickedIndex = parseInt(event.currentTarget.dataset.index);

            if (clickedIndex === activeCellIndex) {
                score++;
                scoreDisplay.textContent = score;
                successSound();
                clearTimeout(monsterTimeout);
                showMonster();
            } else {
                missSound();
            }
        }

        // --- äº‹ä»¶ç›£è½ ---
        startBtn.addEventListener('click', startGame);

        // --- åˆå§‹è¨­å®š ---
        window.onload = () => {
            createGrid(); 
        };

    </script>
</body>
</html>
